"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics_book=globalThis.webpackChunkphysical_ai_humanoid_robotics_book||[]).push([[9525],{9525:(e,s,t)=>{t.d(s,{ChatLauncherButton:()=>f,ChatPanel:()=>E,MobileChatDrawer:()=>I,PortalManager:()=>x});var n=t(6540),a=t(4848);const r=(0,n.createContext)(null),o=()=>{const e=(0,n.useContext)(r);if(!e)throw new Error("useChatUI must be used within a ChatUIProvider");return e},c=({children:e})=>{const[s,t]=(0,n.useState)(!1),[o,c]=(0,n.useState)(!1),i={isOpen:s,openChat:()=>t(!0),closeChat:()=>t(!1),toggleChat:()=>t(!s),isMobile:o,setIsMobile:c};return(0,a.jsx)(r.Provider,{value:i,children:e})},i=(0,n.createContext)(null),l=()=>{const e=(0,n.useContext)(i);if(!e)throw new Error("useChatConversation must be used within a ChatConversationProvider");return e},d=({children:e})=>{const[s,t]=(0,n.useState)([]),[r,o]=(0,n.useState)(!1),[c,l]=(0,n.useState)(null),[d,u]=(0,n.useState)(()=>"undefined"!=typeof window&&localStorage.getItem("chatkit-session-id")||`session-${Date.now()}`),h=(0,n.useCallback)(e=>{t(s=>[...s,e])},[]),m=(0,n.useCallback)((e,s)=>{t(t=>t.map(t=>t.id===e?{...t,...s}:t))},[]),g=(0,n.useCallback)(()=>{t([])},[]),p=(0,n.useCallback)(e=>{o(e)},[]),x={messages:s,addMessage:h,updateMessage:m,clearMessages:g,isStreaming:r,setIsStreaming:(0,n.useCallback)(e=>{o(e)},[]),setStreamingState:p,selectedText:c,setSelectedText:l,sessionId:d};return(0,a.jsx)(i.Provider,{value:x,children:e})},u="https://aman778-rag-chatbot-backend.hf.space",h="undefined"!=typeof window&&(window.ENV?.REACT_APP_BACKEND_URL||window.ENV?.BACKEND_URL||"undefined"!=typeof process&&process.env?.REACT_APP_BACKEND_URL||"undefined"!=typeof process&&process.env?.BACKEND_URL)||u,m=(0,n.createContext)(null),g=({children:e})=>{const[s,t]=(0,n.useState)(null),[r,o]=(0,n.useState)(!0),[i,l]=(0,n.useState)(null),[u,g]=(0,n.useState)([]),[p,x]=(0,n.useState)(!1),[f,v]=(0,n.useState)(null),[w,b]=(0,n.useState)(()=>"undefined"!=typeof window&&localStorage.getItem("chatkit-session-id")||`session-${Date.now()}`);(0,n.useEffect)(()=>{(async()=>{try{const e=await fetch(`${h}/api/v1/config/chatkit`);if(!e.ok)throw new Error(`Failed to load config: ${e.status}`);const s=await e.json();t(s)}catch(e){console.error("Error loading ChatKit config:",e),l(e.message),t({theme:"light",maxTokens:1e3,temperature:.7})}finally{o(!1)}})(),"undefined"!=typeof window&&localStorage.setItem("chatkit-session-id",w)},[w]);const j={config:s,isLoading:r,error:i,messages:u,addMessage:(0,n.useCallback)(e=>{g(s=>[...s,e])},[]),updateMessage:(0,n.useCallback)((e,s)=>{g(t=>t.map(t=>t.id===e?{...t,...s}:t))},[]),clearMessages:(0,n.useCallback)(()=>{g([])},[]),isStreaming:p,setIsStreaming:x,selectedText:f,setSelectedText:v,sessionId:w};return(0,a.jsx)(m.Provider,{value:j,children:(0,a.jsx)(c,{children:(0,a.jsx)(d,{children:e})})})};var p=t(961);const x=({children:e})=>{const[s,t]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if("undefined"!=typeof document){let e=document.getElementById("chatkit-portal-root");return e||(e=document.createElement("div"),e.setAttribute("id","chatkit-portal-root"),e.style.all="initial",document.body.appendChild(e)),t(!0),()=>{const e=document.getElementById("chatkit-portal-root");e&&e.parentNode&&e.parentNode.removeChild(e)}}},[]);const r="undefined"!=typeof document?document.getElementById("chatkit-portal-root"):null;return r&&s?(0,p.createPortal)((0,a.jsx)(g,{children:e}),r):null},f=()=>{const{isOpen:e,toggleChat:s}=o(),{isStreaming:t}=l();return(0,a.jsx)("button",{className:`chat-launcher-button ${e?"open":""} ${t?"streaming":""}`,onClick:s,"aria-label":e?"Close chat":"Open chat",title:e?"Close chat":"Open chat AI assistant",disabled:t,children:t?(0,a.jsxs)("div",{className:"loading-spinner",children:[(0,a.jsx)("div",{className:"spinner-dot"}),(0,a.jsx)("div",{className:"spinner-dot"}),(0,a.jsx)("div",{className:"spinner-dot"})]}):(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon",children:(0,a.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})})};var v=t(7074),w=t(3092),b=t(1911),j=t(2918);const k=({content:e})=>{const s=e||"";return(0,a.jsx)("div",{className:"markdown-renderer",children:(0,a.jsx)(v.oz,{remarkPlugins:[w.A],rehypePlugins:[b.A,j.A],components:{code(e){const{children:s,className:t,...n}=e;return/language-(\w+)/.exec(t||"")?(0,a.jsx)("pre",{...n,className:t,children:(0,a.jsx)("code",{className:t,children:s})}):(0,a.jsx)("code",{...n,className:t,children:s})},a(e){const{href:s,children:t,...n}=e;return(0,a.jsx)("a",{...n,href:s,target:"_blank",rel:"noopener noreferrer",children:t})},table:e=>(0,a.jsx)("div",{className:"table-container",children:(0,a.jsx)("table",{...e})})},children:s})})},y=({message:e})=>{const s="user"===e.role,t="assistant"===e.role,n=e.error,r=e.isStreaming;return(0,a.jsxs)("div",{className:`message-bubble ${s?"user-message":t?"bot-message":""} ${n?"error-message":""}`,children:[(0,a.jsx)("div",{className:"message-avatar",children:s?(0,a.jsx)("span",{className:"user-avatar",children:"\ud83d\udc64"}):(0,a.jsx)("span",{className:"bot-avatar",children:"\ud83e\udd16"})}),(0,a.jsx)("div",{className:"message-content",children:n?(0,a.jsx)("div",{className:"error-content",children:(0,a.jsx)(k,{content:e.content||e.error||"An error occurred"})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k,{content:e.content||e.text||""}),r&&(0,a.jsxs)("div",{className:"typing-indicator",children:[(0,a.jsx)("span",{}),(0,a.jsx)("span",{}),(0,a.jsx)("span",{})]}),e.sources&&e.sources.length>0&&(0,a.jsx)("div",{className:"message-sources",children:(0,a.jsxs)("details",{children:[(0,a.jsx)("summary",{children:"Sources"}),(0,a.jsx)("ul",{children:e.sources.map((e,s)=>(0,a.jsx)("li",{children:e.title||e.text?.substring(0,50)+"..."},s))})]})})]})})]})},C=({messages:e})=>{const s=(0,n.useRef)(null),t=(0,n.useRef)(null);(0,n.useEffect)(()=>{r()},[e]);const r=()=>{s.current?.scrollIntoView({behavior:"smooth"})};return(0,a.jsxs)("div",{className:"chat-message-list",ref:t,onScroll:()=>{if(t.current){const{scrollTop:e,scrollHeight:s,clientHeight:n}=t.current;if(s-e-n>100)return}},children:[e.map(e=>(0,a.jsx)(y,{message:e},e.id)),(0,a.jsx)("div",{ref:s})]})},S=async(e,s)=>{console.log("Sending message to backend:",{backendUrl:h,message:e.message,sessionId:e.sessionId});try{if(s){console.log("Using streaming endpoint...");const n=await fetch(`${h}/api/v1/chat/stream`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e.message,session_id:e.sessionId,max_context:5})});if(console.log("Stream response received:",n.status),!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const a=n.body.getReader(),r=new TextDecoder;let o="";for(;;){const{done:e,value:n}=await a.read();if(e){console.log("Stream reading completed");break}o+=r.decode(n,{stream:!0});const c=o.split("\n");o=c.pop()||"";for(const a of c)if(a.startsWith("data: "))try{const e=JSON.parse(a.slice(6));if("token"===e.type&&s)console.log("Token received:",e.content),s(e.content);else if("sources"===e.type)console.log("Sources received:",e.sources);else if("complete"===e.type){console.log("Stream complete event received");break}}catch(t){console.warn("Malformed JSON in stream:",a)}}return{success:!0}}{console.log("Using regular chat endpoint...");const s=await fetch(`${h}/api/v1/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e.message,session_id:e.sessionId,max_context:5})});if(console.log("Regular response received:",s.status),!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();return console.log("Response data received:",t),t}}catch(n){throw console.error("Error sending message:",n),n}},N=()=>{const[e,s]=(0,n.useState)(""),[t,r]=(0,n.useState)(!1),o=(0,n.useRef)(null),{addMessage:c,selectedText:i,sessionId:d,updateMessage:u,setIsStreaming:h}=l(),m=(0,n.useCallback)(()=>{o.current&&(o.current.style.height="auto",o.current.style.height=Math.min(o.current.scrollHeight,150)+"px")},[]),g=async()=>{if(!e.trim()||t)return;r(!0);const n=`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;c({id:n,role:"user",content:e,timestamp:new Date});const a={message:e,context:{selected_text:i||null,page:"undefined"!=typeof window?window.location.pathname:""},sessionId:d},l=`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;c({id:l,role:"assistant",content:"",timestamp:new Date,isStreaming:!0});let m="";h(!0);try{await S(a,async e=>{m+=e,u(l,{content:m,isStreaming:!0})}),u(l,{isStreaming:!1}),s(""),o.current&&(o.current.style.height="auto")}catch(g){console.error("Error sending message:",g),u(l,{content:`Error: ${g.message}`,isStreaming:!1,error:!0})}finally{r(!1),h(!1)}},p=t;return(0,a.jsxs)("div",{className:"chat-input-bar",children:[i&&(0,a.jsxs)("div",{className:"selected-text-indicator",children:['Using selected text as context: "',i.substring(0,50),i.length>50?"...":"",'"']}),(0,a.jsxs)("div",{className:"input-container",children:[(0,a.jsx)("textarea",{ref:o,value:e,onChange:e=>{s(e.target.value),m()},onKeyDown:s=>{"Enter"!==s.key||s.shiftKey||(s.preventDefault(),!t&&e.trim()&&g())},placeholder:i?"Ask about the selected text...":"Message AI assistant...",className:"chat-textarea",disabled:p,rows:1}),(0,a.jsx)("button",{onClick:g,disabled:p||!e.trim(),className:"send-button "+(e.trim()?"active":""),"aria-label":"Send message",children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),(0,a.jsx)("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]})})]})]})},E=()=>{const{isOpen:e,closeChat:s}=o(),{isMobile:t}=o(),{messages:r}=l(),c=(0,n.useRef)(null);return(0,n.useEffect)(()=>{const t=e=>{!c.current||c.current.contains(e.target)||e.target.closest(".chat-launcher-button")||s()};return e&&document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[e,s]),(0,n.useEffect)(()=>{const t=e=>{"Escape"===e.key&&s()};return e&&document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[e,s]),!e||t?null:(0,a.jsx)("div",{className:"chat-panel-backdrop",children:(0,a.jsxs)("div",{className:"chat-panel",ref:c,children:[(0,a.jsxs)("div",{className:"chat-header",children:[(0,a.jsx)("h3",{children:"AI Assistant"}),(0,a.jsx)("button",{className:"close-button",onClick:s,"aria-label":"Close chat",children:"\xd7"})]}),(0,a.jsxs)("div",{className:"chat-content",children:[(0,a.jsx)(C,{messages:r}),(0,a.jsx)(N,{})]})]})})},I=()=>{const{isOpen:e,closeChat:s,isMobile:t}=o(),{messages:r}=l(),c=(0,n.useRef)(null);return(0,n.useEffect)(()=>{const n=e=>{"Escape"===e.key&&s()};return e&&t&&document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}},[e,t,s]),e&&t?(0,a.jsx)("div",{className:"mobile-drawer-overlay",children:(0,a.jsxs)("div",{className:"mobile-drawer",ref:c,children:[(0,a.jsxs)("div",{className:"mobile-drawer-header",children:[(0,a.jsx)("button",{className:"back-button",onClick:s,"aria-label":"Back to content",children:"\u2190"}),(0,a.jsx)("h3",{children:"AI Assistant"}),(0,a.jsx)("div",{className:"header-spacer"})]}),(0,a.jsxs)("div",{className:"mobile-drawer-content",children:[(0,a.jsx)(C,{messages:r}),(0,a.jsx)(N,{})]})]})}):null}}}]);